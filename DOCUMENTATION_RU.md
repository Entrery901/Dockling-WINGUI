# Dockling WINGUI — Документация (русский)

**Dockling WINGUI** — приложение, которое **работает из коробки** и превращает документы (PDF, DOCX, PPTX, XLSX, HTML и др.) в Markdown для последующей отправки в RAG и использования в ИИ. Многие сталкиваются с тем, что такого готового решения нет; Dockling WINGUI решает эту задачу одной программой: EXE, выбор папок, конвертация.

Полное руководство по установке, настройке и использованию.

---

## 1. Установка и первый запуск

### 1.1. Подготовка

1. Распакуйте или скопируйте содержимое папки `release` в удобное место.
2. Скопируйте `env.example` в файл `.env` в той же папке, где лежит `DocklingGUI.exe`.
3. При необходимости отредактируйте `.env` (пути, OCR, лимиты и т.п.).
4. Создайте папки для входящих и исходящих файлов (по умолчанию — `input` и `output`), либо укажите свои пути в настройках GUI.

### 1.2. Запуск EXE

- Дважды щёлкните по `DocklingGUI.exe`.
- При первом запуске возможно краткое отображение загрузочного экрана.
- **Первый запуск занимает более 2 минут** (инициализация Docling, PyTorch, при необходимости — загрузка моделей EasyOCR). Окно может долго не отвечать — это нормально, дождитесь появления интерфейса. Последующие запуски значительно быстрее.
- Окно приложения откроется на русском по умолчанию; язык можно сменить переключателем **РУ / EN** справа вверху.

### 1.3. Запуск из исходного кода (для разработчиков)

```powershell
cd release
pip install -r requirements.txt
python gui_app.py
```

Убедитесь, что в этой же папке есть `images` и `.env` (скопированный из `env.example`).

---

## 2. Интерфейс: вкладки и настройки

### 2.1. API настройки

- **OpenRouter API ключ** — для AI‑описаний изображений. Оставьте пустым, если описание картинок не нужно.
- **Модель** — модель для описаний (например, `x-ai/grok-4-fast` или аналог через OpenRouter).
- **Макс. токенов** — лимит токенов на один запрос описания.
- **Base URL** — базовый URL API (по умолчанию OpenRouter).
- **Включить AI описания изображений** — вкл/выкл использование API для подписей к рисункам.
- **Промпт для описаний** — текст, который задаёт стиль описания.

Настройки сохраняются в `.env` по кнопке **«Сохранить настройки»**.

### 2.2. Пути к папкам

- **Обработать всю папку** — конвертация всех подходящих файлов из выбранной папки.
- **Выбрать отдельные файлы** — конвертация только отмеченных файлов.
- **Входящие документы** — папка с исходными файлами (или базовая при выборе файлов).
- **Исходящие документы** — папка для готовых `.md` файлов.
- **Создать папку автоматически** — создание папки результатов, если её нет.

Кнопки **«Выбрать...»** открывают выбор каталогов; **«Выбрать файлы...»** — выбор конкретных файлов.

### 2.3. Обработка

- **Включить OCR распознавание** — распознавание текста в сканах и картинках.
- **OCR движок**:
  - **EasyOCR** — встроен, не требует отдельной установки; медленнее и тяжелее по памяти.
  - **Tesseract** — быстрее и легче, но требует установки Tesseract в систему.
- **Кнопка «Установить Tesseract...»** — проверка наличия Tesseract; при отсутствии открывается страница загрузки и даётся краткая инструкция.
- **Языки OCR** — через запятую, например `rus,eng` (для Tesseract) или `ru,en` (для EasyOCR; при необходимости конвертируется автоматически).
- **Распознавание таблиц** — вкл/выкл.
- **Режим таблиц** — **Точный** (accurate) или **Быстрый** (fast).
- **Извлечение изображений** — сохранять ли картинки из документов.
- **Масштаб изображений** — 1.0 = без масштабирования, 2.0 = увеличение и т.д.

### 2.4. Аппаратное ускорение

- **Ускоритель** — AUTO, CPU, CUDA (NVIDIA), GPU, MPS (Apple).
- **CPU потоков** — 0 = авто.
- **Статус GPU** — отображает, видит ли приложение видеокарту.

### 2.5. Ограничения

- **Макс. размер файла (МБ)** — 0 = без ограничения.
- **Макс. страниц** — 0 = без ограничения.
- **Продолжать при ошибках** — при сбое одного файла продолжать обработку остальных.

### 2.6. О программе

- Информация об авторе, контакты, донаты (в т.ч. QR).

---

## 3. Работа с приложением

### 3.1. Запуск конвертации

1. Задайте папки или файлы (вкладка **Пути к папкам**).
2. При необходимости настройте OCR, таблицы, изображения, ускоритель и лимиты.
3. Нажмите **«Начать конвертацию»**.

### 3.2. Прогресс и журнал

- **Текущий файл** — имя обрабатываемого файла и счётчик.
- **Прогресс‑бар** — общий прогресс по текущему файлу.
- **Прошло / Осталось** — время работы и ориентировочное оставшееся.
- **Статистика** — Успешно, Частично, Ошибок, Пропущено.
- **Журнал** — сообщения с индикаторами (успех, предупреждение, ошибка и т.п.). Кнопка **«Очистить журнал»** очищает только отображение.

### 3.3. Остановка

- **«Остановить»** — запрос на остановку; текущий файл будет обработан до конца, затем конвертация прекратится.
- При закрытии окна во время работы появится запрос подтверждения.

### 3.4. Сохранение настроек

- **«Сохранить настройки»** — запись текущих настроек в `.env` в папку с `DocklingGUI.exe`. Эти настройки подхватываются при следующем запуске.

---

## 4. OCR: EasyOCR и Tesseract

### 4.1. EasyOCR (по умолчанию)

- Уже включён в EXE, отдельная установка не нужна.
- **Первый запуск приложения занимает более 2 минут** — в том числе из‑за инициализации EasyOCR и при необходимости загрузки моделей. Ожидайте появления окна.
- Требует больше оперативной памяти.
- Хорошо подходит для некачественных сканов.

### 4.2. Tesseract

- Нужен установленный Tesseract в системе (например, из [UB‑Mannheim](https://github.com/UB-Mannheim/tesseract/wiki)).
- Рекомендуемая папка: `C:\Program Files\Tesseract-OCR`.
- В GUI: вкладка **Обработка** → выберите **Tesseract** → при необходимости нажмите **«Установить Tesseract...»** (проверка, ссылка на загрузку, краткая инструкция).
- Языки задаются в формате `rus,eng` и т.п.; нужны соответствующие языковые пакеты Tesseract.

---

## 5. Файл .env

Создаётся копированием `env.example` в `.env`. Основные группы параметров:

- **OCR:** `ENABLE_OCR`, `OCR_ENGINE`, `OCR_LANGUAGES`
- **Таблицы:** `ENABLE_TABLE_STRUCTURE`, `TABLE_STRUCTURE_MODE`
- **Изображения:** `GENERATE_PICTURE_IMAGES`, `IMAGES_SCALE`, `ENABLE_PICTURE_DESCRIPTION`, `PICTURE_DESCRIPTION_PROMPT`
- **API:** `USE_OPENAI_API`, `OPENAI_API_KEY`, `OPENAI_BASE_URL`, `OPENAI_MODEL_NAME`, `OPENAI_MAX_TOKENS`, `OPENAI_TIMEOUT`, `OPENAI_TEMPERATURE`, `ENABLE_REMOTE_SERVICES`
- **Лимиты:** `MAX_NUM_PAGES`, `MAX_FILE_SIZE`, `CONTINUE_ON_ERROR`
- **Пути:** `INPUT_DIR`, `OUTPUT_DIR`

Подробные комментарии — в `env.example`.

---

## 6. Поддерживаемые форматы

PDF, DOCX, DOC, PPTX, PPT, XLSX, XLS, HTML, HTM, XML, MD, AsciiDoc (.asciidoc, .adoc).

---

## 7. Устранение неполадок

### 7.1. EXE не запускается

- **Первый запуск длится более 2 минут** — если окно не появляется, подождите (инициализация моделей). Не закрывайте процесс.
- Убедитесь, что `.env` лежит в одной папке с `DocklingGUI.exe`.
- Проверьте антивирус и исключения для папки.
- Запуск из командной строки: `DocklingGUI.exe` — иногда в консоли видно сообщение об ошибке.

### 7.2. «Входная папка не существует» / «Нет файлов»

- Проверьте путь во вкладке **Пути** и что в папке есть файлы с нужными расширениями.
- В режиме «Выбрать отдельные файлы» убедитесь, что файлы действительно выбраны.

### 7.3. Ошибки при конвертации

- Смотрите **Журнал** в GUI и файл `conversion.log` в папке приложения.
- Проверьте размер файла и лимиты (макс. размер, макс. страниц).
- Для проблемных PDF попробуйте отключить OCR или сменить движок.

### 7.4. CUDA / GPU не определяется

- Во вкладке **Аппаратное ускорение** выберите **CPU** или **AUTO**.
- Проверьте драйверы NVIDIA и что PyTorch в сборке видит CUDA (в EXE это уже задано сборкой).

### 7.5. Tesseract не находится

- Установите Tesseract (см. раздел 4.2 и кнопку **«Установить Tesseract...»**).
- Добавьте каталог Tesseract в PATH или задайте `TESSERACT_HOME` / `TESSERACT_PATH` в `.env` (если приложение это поддерживает через конфиг).

### 7.6. Медленная работа / нехватка памяти

- Уменьшите `IMAGES_SCALE`, отключите `GENERATE_PICTURE_IMAGES` или OCR.
- Режим таблиц **Быстрый** вместо **Точный**.
- Обрабатывайте меньше файлов за один раз или увеличьте объём ОЗУ.

---

## 8. Логи

- **Журнал в GUI** — отображает ход конвертации в реальном времени.
- **conversion.log** — пишется в папку с `DocklingGUI.exe` (или с `gui_app.py` при запуске из кода) с деталями обработки и ошибок.

---

## 9. Ручная сборка EXE

Пошаговая инструкция по сборке `DocklingGUI.exe` из исходников на Windows.

### 9.1. Требования для сборки

- **Windows 10/11 (64‑bit)**
- **Python 3.11** (рекомендуется; возможны 3.9–3.12 в зависимости от совместимости зависимостей)
- **pip**
- **~10 ГБ** свободного места (venv, PyTorch, Docling, модели EasyOCR)
- **Интернет** — для установки пакетов и при первом запуске EasyOCR (если модели не включены в spec)

### 9.2. Подготовка окружения

1. Откройте PowerShell в корне проекта (или в папке `release` с исходниками).

2. Создайте виртуальное окружение и активируйте:

   ```powershell
   python -m venv venv311
   .\venv311\Scripts\Activate.ps1
   ```

3. Установите зависимости:

   ```powershell
   pip install -r requirements.txt
   pip install pyinstaller
   ```

4. **Модели EasyOCR (обязательно для включения в EXE):**  
   Чтобы не скачивать их при первом запуске у пользователя, их нужно положить в пакет.  
   - Вариант А: один раз запустите `python gui_app.py` и дождитесь загрузки моделей EasyOCR в `%USERPROFILE%\.EasyOCR\model`.  
   - Вариант Б: скопируйте готовую папку `C:\Users\<user>\.EasyOCR\model` с другой машины.  
   В `build_exe.spec` в `datas_base` указан путь к этой папке — **замените его на свой** (например, `C:\Users\YourName\.EasyOCR\model`). Если путь неверный, PyInstaller пропустит файлы, и при первом запуске EXE EasyOCR будет качать модели (долго).

### 9.3. Правка `build_exe.spec`

Откройте `build_exe.spec` в редакторе и при необходимости измените:

| Что | Где в spec | Ваши значения |
|-----|------------|----------------|
| Путь к venv (docling, docling_parse и т.п.) | `datas_base` | Замените `venv311\\Lib\\site-packages\\...` на путь к вашему venv, например `venv311\\Lib\\site-packages\\...` если venv в корне проекта. |
| Модели EasyOCR | `('C:\\Users\\conso\\.EasyOCR\\model', '.EasyOCR\\model')` | Подставьте свой путь к `%USERPROFILE%\\.EasyOCR\\model` (после того как EasyOCR уже что‑то скачал при `python gui_app.py`). |

- Файлы `docling-*.dist-info`, `docling_parse`, `docling_core` и т.п. должны указывать на `venv\Lib\site-packages\` вашего окружения.
- Папка `images` — должна быть в корне проекта (или укажите свой путь).

### 9.4. Tesseract (опционально)

Чтобы **включить Tesseract в EXE**:

- Установите Tesseract до сборки в `C:\Program Files\Tesseract-OCR` (или задайте `TESSERACT_HOME` / `TESSERACT_PATH`).
- В `build_exe.spec` логика сама подхватит DLL и `tessdata`, если папка существует.

Если Tesseract не установлен — в EXE он не попадёт; пользователь сможет установить его отдельно и нажать «Установить Tesseract...» во вкладке «Обработка» для проверки.

### 9.5. Запуск сборки

1. Очистка предыдущей сборки (по желанию):

   ```powershell
   if (Test-Path build) { Remove-Item -Recurse -Force build }
   if (Test-Path dist)  { Remove-Item -Recurse -Force dist }
   ```

2. Запуск PyInstaller:

   ```powershell
   pyinstaller build_exe.spec --noconfirm
   ```

   Или через скрипт (если он в корне проекта):

   ```powershell
   .\build.bat
   ```

3. **Время сборки:** обычно **5–15 минут** в зависимости от диска и CPU.

4. Результат: `dist\DocklingGUI.exe`.

### 9.6. Проверка

- Скопируйте `DocklingGUI.exe` в тестовую папку вместе с `.env` (из `env.example`), создайте `input` и `output`.
- Запустите EXE. **Первый запуск займёт более 2 минут** — это нормально.
- Проверьте конвертацию одного PDF.

### 9.7. Частые ошибки при сборке

- **`ModuleNotFoundError` или `Hidden import not found`** — в `build_exe.spec` в `hiddenimports` уже перечислены основные модули; при необходимости добавьте недостающие.
- **`FileNotFoundError` для `venv311\...` или `EasyOCR\model`** — исправьте пути в `datas_base` на свои.
- **Очень большой EXE (2–3 ГБ)** — нормально: в пакет входят PyTorch, Docling, EasyOCR и зависимости.

---

## 10. Лицензии и сторонние компоненты

В приложении используются сторонние компоненты:

— **Docling (IBM).** Лицензия MIT.  
Данная технология обеспечивает качественную конвертацию документов.  
Мы выражаем благодарность разработчикам IBM за создание этого инструмента.

Подробности: [Docling](https://github.com/docling-project/docling).

---

## 11. Контакты и поддержка

- Информация об авторе и способах поддержки — во вкладке **О программе** в приложении.
- Документация Docling: [docling-project.github.io/docling](https://docling-project.github.io/docling/).
